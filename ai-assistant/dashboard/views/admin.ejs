<section
  x-data="{
    formData: {
      api_key: '<%= globalConfig.api_key %>'
    },
    saving: false,
    async submitForm() {
      this.saving = true;
      try {
        const response = await fetch(window.location.href, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(this.formData)
        });
        if (!response.ok) throw new Error();
        Alpine.store('toast').show('<%=tr(`CONFIG_SAVE`)%>', 'success');
      } catch (error) {
        Alpine.store('toast').show('<%=tr(`CONFIG_SAVE_ERROR`)%>', 'error');
      } finally {
        this.saving = false;
      }
    }
  }"
  class="rounded-2xl bg-white p-6 shadow-lg dark:bg-[#090e2c] transition-colors duration-300 mb-6">

  <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">
    <%= tr("ai-assistant:CONFIG_TITLE") %>
  </h3>
  <p class="mb-6 text-sm text-gray-500 dark:text-gray-400">
    <%= tr("ai-assistant:CONFIG_DESC") %>
  </p>

  <form @submit.prevent="submitForm" class="space-y-6">

    <!-- API KEY -->
    <div>
      <label class="block text-sm font-bold text-gray-700 dark:text-gray-200">
        <%= tr("ai-assistant:API_KEY") %>
      </label>
      <p class="mb-3 text-xs text-gray-500 dark:text-gray-400">
        <%= tr("ai-assistant:API_KEY_DESC") %>
      </p>
      <div class="relative">
        <input
          :type="showKey ? 'text' : 'password'"
          x-model="formData.api_key"
          x-data="{ showKey: false }"
          placeholder="AIzaSy..."
          class="w-full rounded-xl bg-gray-50 px-4 py-3 pr-12 text-sm font-medium text-gray-900 dark:bg-white/5 dark:text-white placeholder-gray-400 outline-none border-none focus:ring-2 focus:ring-purple-500/30 transition-all"
        />
        <button type="button" @click="showKey = !showKey"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
          <i class="fa-solid" :class="showKey ? 'fa-eye-slash' : 'fa-eye'" style="font-size:14px"></i>
        </button>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="flex items-center justify-end border-t border-gray-200 pt-6 dark:border-gray-700">
      <button type="submit" :disabled="saving"
        class="inline-flex items-center justify-center gap-2 rounded-xl bg-green-500/10 dark:bg-green-500/20 px-6 py-2.5 font-bold text-green-700 dark:text-green-300 transition-all duration-300 shadow-[0_10px_40px_-10px_rgba(16,185,129,0.4)] hover:scale-105 active:scale-95 disabled:opacity-50 group relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-green-500/0 via-green-500/10 to-green-500/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
        <i class="fa-solid fa-floppy-disk relative z-10" x-show="!saving"></i>
        <i class="fa-solid fa-spinner fa-spin relative z-10" x-show="saving"></i>
        <span class="relative z-10" x-text="saving ? '<%=tr(`BTN_SAVING`)%>' : '<%=tr(`BTN_SAVE`)%>'"></span>
      </button>
    </div>

  </form>
</section>
