<section class="border-border bg-bg-panel rounded-lg border p-6 shadow-sm" 
    x-data="{ 
        generators: <%= JSON.stringify(settings.generators || []) %>,
        saving: false,
        async submitForm() {
            this.saving = true;
            try {
                const resp = await fetch(window.location.href, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ generators: this.generators })
                });
                if (resp.ok) Alpine.store('toast').show('Configuración guardada correctamente', 'success');
                else throw new Error();
            } catch(e) {
                Alpine.store('toast').show('Error al guardar', 'error');
            } finally { this.saving = false; }
        }
    }">
    
    <div class="mb-6">
        <h3 class="text-text text-xl font-bold">Canales Temporales</h3>
        <p class="text-text-muted text-sm">Configura qué canales de voz actúan como "generadores" para crear nuevos canales al entrar.</p>
    </div>

    <form @submit.prevent="submitForm">
        <div class="space-y-4">
            <template x-for="(gen, index) in generators" :key="index">
                <div class="bg-bg-interactive/30 flex flex-wrap gap-4 items-end rounded-xl border border-border p-4">
                    <div class="flex-1 min-w-[200px]">
                        <label class="text-text mb-2 block text-xs font-bold uppercase tracking-wider">Canal de Origen</label>
                        <select x-model="gen.sourceId" class="bg-bg-interactive text-text w-full rounded-lg border border-border p-2 focus:ring-2 focus:ring-primary">
                            <option value="">Selecciona un canal...</option>
                            <% channels.forEach(ch => { %>
                                <option value="<%= ch.id %>"><%= ch.name %></option>
                            <% }) %>
                        </select>
                    </div>

                    <div class="flex-1 min-w-[150px]">
                        <label class="text-text mb-2 block text-xs font-bold uppercase tracking-wider">Prefijo Nombre</label>
                        <input type="text" x-model="gen.namePrefix" placeholder="Ej: Voz" class="bg-bg-interactive text-text w-full rounded-lg border border-border p-2 focus:ring-2 focus:ring-primary">
                    </div>

                    <div class="w-24">
                        <label class="text-text mb-2 block text-xs font-bold uppercase tracking-wider">Límite</label>
                        <input type="number" x-model="gen.userLimit" min="0" max="99" class="bg-bg-interactive text-text w-full rounded-lg border border-border p-2 focus:ring-2 focus:ring-primary">
                    </div>

                    <button type="button" @click="generators.splice(index, 1)" class="hover:bg-red-500/20 rounded-lg p-2 text-red-500 transition-colors">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </template>
        </div>

        <div class="mt-6 flex flex-wrap gap-4 items-center justify-between border-t border-border pt-6">
            <button type="button" @click="generators.push({sourceId: '', namePrefix: 'Voz', userLimit: 0})" class="border-primary text-primary hover:bg-primary/10 flex items-center gap-2 rounded-lg border px-4 py-2 text-sm font-medium transition-all">
                <i class="fa-solid fa-plus"></i> Añadir Nuevo Generador
            </button>

            <button type="submit" :disabled="saving" class="bg-primary hover:bg-primary-dark disabled:opacity-50 flex items-center gap-2 rounded-lg px-8 py-2 font-bold text-white shadow-lg transition-all">
                <i class="fa-solid fa-save" x-show="!saving"></i>
                <span x-text="saving ? 'Guardando...' : 'Guardar Configuración'"></span>
            </button>
        </div>
    </form>
</section>